(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     47130,       1310]
NotebookOptionsPosition[     43704,       1252]
NotebookOutlinePosition[     44090,       1269]
CellTagsIndexPosition[     44047,       1266]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["arbitrary rotation matrix", "Item",
 CellChangeTimes->{{3.896245332062425*^9, 
  3.8962453988006983`*^9}},ExpressionUUID->"209668fd-18c1-45fc-b43f-\
381cc2e6cd6d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"v", " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{"vx", ",", " ", "vy", ",", " ", "vz"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a", " ", ":=", " ", 
   RowBox[{"{", 
    RowBox[{"ax", ",", " ", "ay", ",", " ", "az"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.896228244897756*^9, 3.896228275927318*^9}, {
  3.896228334327982*^9, 3.8962284047589436`*^9}, {3.8962285440007687`*^9, 
  3.896228555223624*^9}, {3.8962285899439473`*^9, 3.8962286018481693`*^9}, {
  3.8962453248344817`*^9, 
  3.8962453284161673`*^9}},ExpressionUUID->"9eb72d7a-445e-495f-9e08-\
fa10cea388e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vc", " ", "=", 
   RowBox[{"a", " ", 
    RowBox[{"Dot", "[", 
     RowBox[{"v", ",", " ", "a"}], "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.896228410285157*^9, 3.8962284738882866`*^9}, 
   3.896228565323989*^9, 3.8962286280492163`*^9, 3.896228892240779*^9},
 CellLabel->"In[20]:=",ExpressionUUID->"4ffd4c0f-1428-4124-95d8-3454b2df4212"],

Cell[BoxData[
 RowBox[{
  RowBox[{"v1", " ", "=", 
   RowBox[{"v", " ", "-", " ", "vc"}]}], " ", ";"}]], "Input",
 CellChangeTimes->{{3.8962286114969044`*^9, 3.896228640591654*^9}, 
   3.896228894648903*^9},
 CellLabel->"In[21]:=",ExpressionUUID->"96cb7322-7544-4bb3-ad58-73e0c8b7c7ab"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"v2", " ", "=", " ", 
  RowBox[{"Cross", "[", 
   RowBox[{"v1", ",", " ", "a"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8962286456164775`*^9, 3.896228656632164*^9}, 
   3.896228896727951*^9, {3.896232137749775*^9, 3.8962321382687073`*^9}},
 CellLabel->"In[75]:=",ExpressionUUID->"3187cc61-e354-41c6-a8bd-ef2077b6f6ff"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"az", " ", "vy"}], "-", 
    RowBox[{"ay", " ", "vz"}]}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "az"}], " ", "vx"}], "+", 
    RowBox[{"ax", " ", "vz"}]}], ",", 
   RowBox[{
    RowBox[{"ay", " ", "vx"}], "-", 
    RowBox[{"ax", " ", "vy"}]}]}], "}"}]], "Output",
 CellChangeTimes->{3.896232138785044*^9},
 CellLabel->"Out[75]=",ExpressionUUID->"40ed33fa-06f9-491d-879d-a8094f746a0e"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"v", "'"}], " ", "=", " ", 
   RowBox[{"vc", " ", "+", " ", 
    RowBox[{"v1", " ", 
     RowBox[{"Cos", "[", "theta", "]"}]}], " ", "+", " ", 
    RowBox[{"v2", " ", 
     RowBox[{"Sin", "[", "theta", "]"}]}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.896228721043992*^9, 3.8962287581278715`*^9}, 
   3.8962288991529274`*^9, 3.896228940210003*^9, {3.896229689664566*^9, 
   3.8962296942247868`*^9}, {3.8962338418368607`*^9, 
   3.8962338437323995`*^9}, {3.896234472530853*^9, 3.89623448213068*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"f5ab1201-ae2a-45f5-badc-23f86f96ef1a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vvx", " ", "=", " ", 
   RowBox[{
    RowBox[{"v", "'"}], " ", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"vx", "\[Rule]", "1"}], ",", " ", 
      RowBox[{"vy", "\[Rule]", "0"}], ",", " ", 
      RowBox[{"vz", "\[Rule]", "0"}], ",", " ", 
      RowBox[{
       RowBox[{"Sin", "[", "theta", "]"}], "\[Rule]", "sin"}], ",", " ", 
      RowBox[{
       RowBox[{"Cos", "[", "theta", "]"}], "\[Rule]", "cos"}]}], "}"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8962287642562585`*^9, 3.896228869751749*^9}, {
   3.8962289167603626`*^9, 3.8962289200639544`*^9}, 3.896233859861288*^9, {
   3.896234468779808*^9, 3.8962344843225846`*^9}, {3.89623453142089*^9, 
   3.89623453915499*^9}},
 CellLabel->
  "In[118]:=",ExpressionUUID->"3179ea4c-9bb3-4dfb-adf9-5c6df0afe4b0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vvy", " ", "=", " ", 
   RowBox[{
    RowBox[{"v", "'"}], " ", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"vx", "\[Rule]", "0"}], ",", " ", 
      RowBox[{"vy", "\[Rule]", "1"}], ",", " ", 
      RowBox[{"vz", "\[Rule]", "0"}], ",", " ", 
      RowBox[{
       RowBox[{"Sin", "[", "theta", "]"}], "\[Rule]", "sin"}], ",", " ", 
      RowBox[{
       RowBox[{"Cos", "[", "theta", "]"}], "\[Rule]", "cos"}]}], "}"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8962289113705316`*^9, 3.8962289368233566`*^9}, 
   3.8962338647094917`*^9, {3.896234466123488*^9, 3.896234486691025*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"c1cf67bf-211a-47ac-a3eb-b53f46859a92"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vvz", " ", "=", " ", 
   RowBox[{
    RowBox[{"v", "'"}], " ", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"vx", "\[Rule]", "0"}], ",", " ", 
      RowBox[{"vy", "\[Rule]", "0"}], ",", " ", 
      RowBox[{"vz", "\[Rule]", "1"}], ",", " ", 
      RowBox[{
       RowBox[{"Sin", "[", "theta", "]"}], "\[Rule]", "sin"}], ",", " ", 
      RowBox[{
       RowBox[{"Cos", "[", "theta", "]"}], "\[Rule]", "cos"}]}], "}"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.896228922175589*^9, 3.896228954903499*^9}, {
   3.896229031553532*^9, 3.896229032969283*^9}, 3.896233875813283*^9, {
   3.896234463459633*^9, 3.896234464282222*^9}, 3.8962344951787405`*^9},
 CellLabel->
  "In[114]:=",ExpressionUUID->"005be437-3579-4650-8ddd-a25fb451cf21"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vvx", ",", " ", "vvy", ",", " ", "vvz"}], "}"}], ",", " ", 
    RowBox[{"{", "2", "}"}]}], "]"}], "//", "MatrixForm"}]], "Input",
 CellChangeTimes->{{3.8962290344207735`*^9, 3.8962290720955286`*^9}, {
   3.8962291049516687`*^9, 3.896229216167473*^9}, {3.896229347082224*^9, 
   3.896229356575869*^9}, {3.896229388344331*^9, 3.8962293953832197`*^9}, {
   3.8962294381044407`*^9, 3.896229453343566*^9}, 3.8962294851274166`*^9, {
   3.8962295564801517`*^9, 3.896229557375514*^9}, {3.896229598832035*^9, 
   3.8962296470787644`*^9}, {3.8962297112162876`*^9, 3.896229804832431*^9}, {
   3.8962298525064883`*^9, 3.896229861270111*^9}, {3.8962317417662535`*^9, 
   3.8962317663351097`*^9}, {3.8962334324419813`*^9, 
   3.8962334667086377`*^9}, {3.8962336950362363`*^9, 
   3.8962338108613915`*^9}, {3.896233884116249*^9, 3.896233963403673*^9}, {
   3.8962340605491514`*^9, 3.896234127371168*^9}, {3.8962341656591277`*^9, 
   3.896234174938714*^9}, {3.8962342119563074`*^9, 3.896234271667425*^9}, {
   3.8962343192272024`*^9, 3.896234338170212*^9}, {3.896234501899548*^9, 
   3.896234510810927*^9}},
 CellLabel->
  "In[116]:=",ExpressionUUID->"6e395f7f-a1aa-4e8f-b3bc-13ddd4c0a46f"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       SuperscriptBox["ax", "2"], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          SuperscriptBox["ax", "2"]}], ")"}], " ", "cos"}]}], 
      RowBox[{
       RowBox[{"ax", " ", "ay"}], "-", 
       RowBox[{"ax", " ", "ay", " ", "cos"}], "+", 
       RowBox[{"az", " ", "sin"}]}], 
      RowBox[{
       RowBox[{"ax", " ", "az"}], "-", 
       RowBox[{"ax", " ", "az", " ", "cos"}], "-", 
       RowBox[{"ay", " ", "sin"}]}]},
     {
      RowBox[{
       RowBox[{"ax", " ", "ay"}], "-", 
       RowBox[{"ax", " ", "ay", " ", "cos"}], "-", 
       RowBox[{"az", " ", "sin"}]}], 
      RowBox[{
       SuperscriptBox["ay", "2"], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          SuperscriptBox["ay", "2"]}], ")"}], " ", "cos"}]}], 
      RowBox[{
       RowBox[{"ay", " ", "az"}], "-", 
       RowBox[{"ay", " ", "az", " ", "cos"}], "+", 
       RowBox[{"ax", " ", "sin"}]}]},
     {
      RowBox[{
       RowBox[{"ax", " ", "az"}], "-", 
       RowBox[{"ax", " ", "az", " ", "cos"}], "+", 
       RowBox[{"ay", " ", "sin"}]}], 
      RowBox[{
       RowBox[{"ay", " ", "az"}], "-", 
       RowBox[{"ay", " ", "az", " ", "cos"}], "-", 
       RowBox[{"ax", " ", "sin"}]}], 
      RowBox[{
       SuperscriptBox["az", "2"], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          SuperscriptBox["az", "2"]}], ")"}], " ", "cos"}]}]}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{
  3.8962337245378094`*^9, {3.896233758315558*^9, 3.8962338118506913`*^9}, {
   3.8962338861337414`*^9, 3.896233963892389*^9}, 3.8962341758711185`*^9, {
   3.896234217537303*^9, 3.8962342721442933`*^9}, 3.896234339146387*^9, {
   3.8962344981189976`*^9, 3.8962345113290234`*^9}},
 CellLabel->
  "Out[116]//MatrixForm=",ExpressionUUID->"42910cfe-194e-4385-a741-\
d45590df5a5d"]
}, Open  ]],

Cell["\<\
 note : axis transform matrix just like above matrix, but if we rotate a \
point, the rotation direction is opposed to axis rotation direction, which \
will make sin term be opposite.\
\>", "Item",
 CellChangeTimes->{{3.8962293910316334`*^9, 3.8962293920783186`*^9}, 
   3.8962299884145565`*^9, {3.8962347435782814`*^9, 3.8962347451613393`*^9}, {
   3.8962353210503864`*^9, 3.8962353324099092`*^9}, {3.89623538125154*^9, 
   3.896235391992507*^9}, {3.8962354234412794`*^9, 3.8962355823302093`*^9}, {
   3.896245310286035*^9, 3.896245310287033*^9}, {3.896245491442399*^9, 
   3.8962454914433928`*^9}},ExpressionUUID->"2190c82c-85e2-4d56-b643-\
98981319ee91"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Code",
 InitializationCell->False,
 CellChangeTimes->{{3.8962453183417854`*^9, 3.896245319424431*^9}, {
  3.896245407168045*^9, 
  3.896245500385498*^9}},ExpressionUUID->"b635e2f6-ebc6-4e8d-b6b0-\
f8e81c9dc52b"],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{
  3.8962454835185857`*^9},ExpressionUUID->"3c756986-6164-4927-a5fa-\
9470b3b10776"],

Cell["quaternion computation", "Item",
 CellChangeTimes->{{3.8962293910316334`*^9, 3.8962293920783186`*^9}, 
   3.8962299884145565`*^9, {3.8962347435782814`*^9, 3.8962347451613393`*^9}, {
   3.8962353210503864`*^9, 3.8962353324099092`*^9}, {3.89623538125154*^9, 
   3.896235391992507*^9}, {3.8962354234412794`*^9, 3.8962355823302093`*^9}, {
   3.896245310286035*^9, 3.896245310287033*^9}, 3.8962454982990494`*^9, {
   3.8962455458253274`*^9, 
   3.896245560978695*^9}},ExpressionUUID->"fcea923a-c8c1-4d66-b5d4-\
607843cdb9ff"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"q", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"qx", ",", " ", "qy", ",", " ", "qz"}], "}"}], ",", " ", 
       RowBox[{"{", "qw", "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"p", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"px", ",", " ", "py", ",", " ", "pz"}], "}"}], ",", " ", 
       RowBox[{"{", "pw", "}"}]}], "}"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.8962455658617268`*^9, 3.8962455862710624`*^9}, {
  3.896245617823745*^9, 3.896245727720025*^9}, {3.8962458467922187`*^9, 
  3.896245868633213*^9}, {3.896245940575796*^9, 3.8962459963207035`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"a940db92-8077-4575-947c-ef760282914e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"m", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"Cross", "[", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"p", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", "+", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], 
       RowBox[{"p", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], " ", "+", " ", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "1", "]"}], "]"}], 
       RowBox[{
        RowBox[{"p", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}]}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "2", "]"}], "]"}], 
       RowBox[{"p", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], " ", "-", " ", 
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"q", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
        RowBox[{"p", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8962457026547256`*^9, 3.8962457138726597`*^9}, {
  3.896245886687719*^9, 3.8962458907451487`*^9}, {3.896246007169025*^9, 
  3.8962460349033403`*^9}, {3.896246067512409*^9, 3.8962460773277693`*^9}, {
  3.896246118992692*^9, 3.8962462246157165`*^9}, {3.896246480513104*^9, 
  3.8962465184727097`*^9}, {3.8962465768080387`*^9, 3.8962466275687537`*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"825ffb8d-f1ba-4ef2-b29f-845f5ae84f68"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"q", "'"}], " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"-", 
     RowBox[{"q", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", 
    RowBox[{"q", "[", 
     RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"qn", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"Cross", "[", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{
        RowBox[{"q", "'"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", "+", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], 
      RowBox[{
       RowBox[{"q", "'"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], " ", "+", " ", 
     RowBox[{
      RowBox[{"q", "[", 
       RowBox[{"[", "1", "]"}], "]"}], 
      RowBox[{
       RowBox[{
        RowBox[{"q", "'"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"q", "[", 
       RowBox[{"[", "2", "]"}], "]"}], 
      RowBox[{
       RowBox[{"q", "'"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], " ", "-", " ", 
     RowBox[{"Dot", "[", 
      RowBox[{
       RowBox[{"q", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{
        RowBox[{"q", "'"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.8962467113372283`*^9, 3.8962468403599043`*^9}, 
   3.8962483673684063`*^9},
 CellLabel->"In[6]:=",ExpressionUUID->"f1442002-246a-4fa0-9ec6-d30b0158a241"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "qx"}], ",", 
     RowBox[{"-", "qy"}], ",", 
     RowBox[{"-", "qz"}]}], "}"}], ",", 
   RowBox[{"{", "qw", "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.896246750159769*^9, 3.8962468414789643`*^9, 3.8962481955398507`*^9, 
   3.896248317215499*^9, {3.8962483639774723`*^9, 3.896248368160428*^9}},
 CellLabel->"Out[6]=",ExpressionUUID->"bc21a34f-dfe5-4af2-b08a-c5657d51c456"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     SuperscriptBox["qw", "2"], "+", 
     SuperscriptBox["qx", "2"], "+", 
     SuperscriptBox["qy", "2"], "+", 
     SuperscriptBox["qz", "2"]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.896246750159769*^9, 3.8962468414789643`*^9, 3.8962481955398507`*^9, 
   3.896248317215499*^9, {3.8962483639774723`*^9, 3.8962483681634197`*^9}},
 CellLabel->"Out[7]=",ExpressionUUID->"c99d86d1-5c25-4d84-b358-6b922b58e27e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"qInv", " ", "=", " ", 
   RowBox[{
    RowBox[{"q", "'"}], " ", "/", " ", 
    RowBox[{
     RowBox[{"qn", "[", 
      RowBox[{"[", "2", "]"}], "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{"f", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"Cross", "[", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"qInv", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", "+", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], 
      RowBox[{"qInv", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], " ", "+", " ", 
     RowBox[{
      RowBox[{"m", "[", 
       RowBox[{"[", "1", "]"}], "]"}], 
      RowBox[{
       RowBox[{"qInv", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"m", "[", 
       RowBox[{"[", "2", "]"}], "]"}], 
      RowBox[{"qInv", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], " ", "-", " ", 
     RowBox[{"Dot", "[", 
      RowBox[{
       RowBox[{"m", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
       RowBox[{"qInv", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], "}"}]}]}], "Input",
 CellChangeTimes->{{3.8962468726198354`*^9, 3.8962469764248147`*^9}, {
   3.896247673919382*^9, 3.8962476834629383`*^9}, {3.896248109344026*^9, 
   3.896248110991012*^9}, 3.896248160182602*^9, {3.8962484749757915`*^9, 
   3.8962484885418463`*^9}},
 CellLabel->"In[27]:=",ExpressionUUID->"a795cf5f-5c09-48f1-9598-f0acee7276f5"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{"pz", " ", "qw", " ", "qy"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"py", " ", "qx", " ", "qy"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"px", " ", 
        SuperscriptBox["qy", "2"]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"py", " ", "qw", " ", "qz"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"pz", " ", "qx", " ", "qz"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"px", " ", 
        SuperscriptBox["qz", "2"]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"qw", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"px", " ", "qw"}], "+", 
          RowBox[{"pw", " ", "qx"}], "+", 
          RowBox[{"pz", " ", "qy"}], "-", 
          RowBox[{"py", " ", "qz"}]}], ")"}]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"qx", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"pw", " ", "qw"}], "-", 
          RowBox[{"px", " ", "qx"}], "-", 
          RowBox[{"py", " ", "qy"}], "-", 
          RowBox[{"pz", " ", "qz"}]}], ")"}]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]]}], ",", 
     RowBox[{
      RowBox[{"-", 
       FractionBox[
        RowBox[{"pz", " ", "qw", " ", "qx"}], 
        RowBox[{
         SuperscriptBox["qw", "2"], "+", 
         SuperscriptBox["qx", "2"], "+", 
         SuperscriptBox["qy", "2"], "+", 
         SuperscriptBox["qz", "2"]}]]}], "-", 
      FractionBox[
       RowBox[{"py", " ", 
        SuperscriptBox["qx", "2"]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"px", " ", "qx", " ", "qy"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"px", " ", "qw", " ", "qz"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"pz", " ", "qy", " ", "qz"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"py", " ", 
        SuperscriptBox["qz", "2"]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"qw", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"py", " ", "qw"}], "-", 
          RowBox[{"pz", " ", "qx"}], "+", 
          RowBox[{"pw", " ", "qy"}], "+", 
          RowBox[{"px", " ", "qz"}]}], ")"}]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"qy", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"pw", " ", "qw"}], "-", 
          RowBox[{"px", " ", "qx"}], "-", 
          RowBox[{"py", " ", "qy"}], "-", 
          RowBox[{"pz", " ", "qz"}]}], ")"}]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]]}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{"py", " ", "qw", " ", "qx"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"pz", " ", 
        SuperscriptBox["qx", "2"]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"px", " ", "qw", " ", "qy"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"pz", " ", 
        SuperscriptBox["qy", "2"]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"px", " ", "qx", " ", "qz"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"py", " ", "qy", " ", "qz"}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "+", 
      FractionBox[
       RowBox[{"qw", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"pz", " ", "qw"}], "+", 
          RowBox[{"py", " ", "qx"}], "-", 
          RowBox[{"px", " ", "qy"}], "+", 
          RowBox[{"pw", " ", "qz"}]}], ")"}]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]], "-", 
      FractionBox[
       RowBox[{"qz", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"pw", " ", "qw"}], "-", 
          RowBox[{"px", " ", "qx"}], "-", 
          RowBox[{"py", " ", "qy"}], "-", 
          RowBox[{"pz", " ", "qz"}]}], ")"}]}], 
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}]]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     FractionBox[
      RowBox[{"qz", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"pz", " ", "qw"}], "+", 
         RowBox[{"py", " ", "qx"}], "-", 
         RowBox[{"px", " ", "qy"}], "+", 
         RowBox[{"pw", " ", "qz"}]}], ")"}]}], 
      RowBox[{
       SuperscriptBox["qw", "2"], "+", 
       SuperscriptBox["qx", "2"], "+", 
       SuperscriptBox["qy", "2"], "+", 
       SuperscriptBox["qz", "2"]}]], "+", 
     FractionBox[
      RowBox[{"qy", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"py", " ", "qw"}], "-", 
         RowBox[{"pz", " ", "qx"}], "+", 
         RowBox[{"pw", " ", "qy"}], "+", 
         RowBox[{"px", " ", "qz"}]}], ")"}]}], 
      RowBox[{
       SuperscriptBox["qw", "2"], "+", 
       SuperscriptBox["qx", "2"], "+", 
       SuperscriptBox["qy", "2"], "+", 
       SuperscriptBox["qz", "2"]}]], "+", 
     FractionBox[
      RowBox[{"qx", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"px", " ", "qw"}], "+", 
         RowBox[{"pw", " ", "qx"}], "+", 
         RowBox[{"pz", " ", "qy"}], "-", 
         RowBox[{"py", " ", "qz"}]}], ")"}]}], 
      RowBox[{
       SuperscriptBox["qw", "2"], "+", 
       SuperscriptBox["qx", "2"], "+", 
       SuperscriptBox["qy", "2"], "+", 
       SuperscriptBox["qz", "2"]}]], "+", 
     FractionBox[
      RowBox[{"qw", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"pw", " ", "qw"}], "-", 
         RowBox[{"px", " ", "qx"}], "-", 
         RowBox[{"py", " ", "qy"}], "-", 
         RowBox[{"pz", " ", "qz"}]}], ")"}]}], 
      RowBox[{
       SuperscriptBox["qw", "2"], "+", 
       SuperscriptBox["qx", "2"], "+", 
       SuperscriptBox["qy", "2"], "+", 
       SuperscriptBox["qz", "2"]}]]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.8962469767221093`*^9, 3.896247684407571*^9, 
  3.896248111563161*^9, 3.896248161255397*^9, 3.896248197914689*^9, 
  3.8962483194898353`*^9, 3.8962483717273207`*^9, 3.8962486740903273`*^9},
 CellLabel->"Out[28]=",ExpressionUUID->"f92abf02-ab44-43a7-8990-fdfb196c5da2"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"pOrigin", " ", "=", " ", 
    RowBox[{"Flatten", "[", "p", "]"}]}], ";"}], " "}], "\[IndentingNewLine]", 
 RowBox[{"pTrans", " ", "=", "  ", 
  RowBox[{"Flatten", "[", "f", "]"}]}]}], "Input",
 CellChangeTimes->{{3.896247046358805*^9, 3.8962471134259005`*^9}, {
   3.896247595375638*^9, 3.896247653078824*^9}, 3.896247689767336*^9, 
   3.89624838055892*^9, {3.89624864288685*^9, 3.8962486528217306`*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"3cb99798-a53c-45d9-b37a-20c564ee61e1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    FractionBox[
     RowBox[{"pz", " ", "qw", " ", "qy"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"py", " ", "qx", " ", "qy"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"px", " ", 
      SuperscriptBox["qy", "2"]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"py", " ", "qw", " ", "qz"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"pz", " ", "qx", " ", "qz"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"px", " ", 
      SuperscriptBox["qz", "2"]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"qw", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"px", " ", "qw"}], "+", 
        RowBox[{"pw", " ", "qx"}], "+", 
        RowBox[{"pz", " ", "qy"}], "-", 
        RowBox[{"py", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"qx", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"pw", " ", "qw"}], "-", 
        RowBox[{"px", " ", "qx"}], "-", 
        RowBox[{"py", " ", "qy"}], "-", 
        RowBox[{"pz", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]]}], ",", 
   RowBox[{
    RowBox[{"-", 
     FractionBox[
      RowBox[{"pz", " ", "qw", " ", "qx"}], 
      RowBox[{
       SuperscriptBox["qw", "2"], "+", 
       SuperscriptBox["qx", "2"], "+", 
       SuperscriptBox["qy", "2"], "+", 
       SuperscriptBox["qz", "2"]}]]}], "-", 
    FractionBox[
     RowBox[{"py", " ", 
      SuperscriptBox["qx", "2"]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"px", " ", "qx", " ", "qy"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"px", " ", "qw", " ", "qz"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"pz", " ", "qy", " ", "qz"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"py", " ", 
      SuperscriptBox["qz", "2"]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"qw", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"py", " ", "qw"}], "-", 
        RowBox[{"pz", " ", "qx"}], "+", 
        RowBox[{"pw", " ", "qy"}], "+", 
        RowBox[{"px", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"qy", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"pw", " ", "qw"}], "-", 
        RowBox[{"px", " ", "qx"}], "-", 
        RowBox[{"py", " ", "qy"}], "-", 
        RowBox[{"pz", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]]}], ",", 
   RowBox[{
    FractionBox[
     RowBox[{"py", " ", "qw", " ", "qx"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"pz", " ", 
      SuperscriptBox["qx", "2"]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"px", " ", "qw", " ", "qy"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"pz", " ", 
      SuperscriptBox["qy", "2"]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"px", " ", "qx", " ", "qz"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"py", " ", "qy", " ", "qz"}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"qw", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"pz", " ", "qw"}], "+", 
        RowBox[{"py", " ", "qx"}], "-", 
        RowBox[{"px", " ", "qy"}], "+", 
        RowBox[{"pw", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "-", 
    FractionBox[
     RowBox[{"qz", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"pw", " ", "qw"}], "-", 
        RowBox[{"px", " ", "qx"}], "-", 
        RowBox[{"py", " ", "qy"}], "-", 
        RowBox[{"pz", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]]}], ",", 
   RowBox[{
    FractionBox[
     RowBox[{"qz", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"pz", " ", "qw"}], "+", 
        RowBox[{"py", " ", "qx"}], "-", 
        RowBox[{"px", " ", "qy"}], "+", 
        RowBox[{"pw", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"qy", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"py", " ", "qw"}], "-", 
        RowBox[{"pz", " ", "qx"}], "+", 
        RowBox[{"pw", " ", "qy"}], "+", 
        RowBox[{"px", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"qx", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"px", " ", "qw"}], "+", 
        RowBox[{"pw", " ", "qx"}], "+", 
        RowBox[{"pz", " ", "qy"}], "-", 
        RowBox[{"py", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]], "+", 
    FractionBox[
     RowBox[{"qw", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"pw", " ", "qw"}], "-", 
        RowBox[{"px", " ", "qx"}], "-", 
        RowBox[{"py", " ", "qy"}], "-", 
        RowBox[{"pz", " ", "qz"}]}], ")"}]}], 
     RowBox[{
      SuperscriptBox["qw", "2"], "+", 
      SuperscriptBox["qx", "2"], "+", 
      SuperscriptBox["qy", "2"], "+", 
      SuperscriptBox["qz", "2"]}]]}]}], "}"}]], "Output",
 CellChangeTimes->{{3.896247057124034*^9, 3.8962471137628503`*^9}, {
   3.896247612210785*^9, 3.8962476476687336`*^9}, 3.896247690089176*^9, 
   3.896248116400346*^9, 3.8962481663368435`*^9, 3.8962482001912055`*^9, 
   3.8962483208360043`*^9, 3.8962483809344587`*^9, 3.896248678048191*^9},
 CellLabel->"Out[30]=",ExpressionUUID->"1b9dd5ab-f7fb-4956-b6cb-1f59f61c38af"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Ax", " ", "=", " ", 
   RowBox[{"pTrans", " ", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"px", " ", "\[Rule]", " ", "1"}], ",", " ", 
      RowBox[{"py", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{"pz", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{"pw", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}], " ", "\[Rule]", " ", "1"}]}], "}"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8962473210826645`*^9, 3.896247392591467*^9}, 
   3.8962477123449574`*^9, {3.896247755230053*^9, 3.8962477741605124`*^9}, {
   3.8962478611357775`*^9, 3.8962479511095533`*^9}, {3.896248275334612*^9, 
   3.896248280686895*^9}, 3.896248655535324*^9, {3.8962488098060827`*^9, 
   3.8962488152062054`*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"d06aee18-c3e2-4048-ba83-f90311bb0ef9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Ay", " ", "=", " ", 
   RowBox[{"pTrans", " ", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"px", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{"py", " ", "\[Rule]", " ", "1"}], ",", " ", 
      RowBox[{"pz", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{"pw", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}], " ", "\[Rule]", " ", "1"}]}], "}"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.896247959959589*^9, 3.896247967078264*^9}, {
   3.8962482824716425`*^9, 3.896248288142001*^9}, 3.896248657638962*^9, 
   3.8962488231910243`*^9},
 CellLabel->"In[40]:=",ExpressionUUID->"57593f1d-d076-4867-9cc6-b8872f3052c2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Az", " ", "=", " ", 
   RowBox[{"pTrans", " ", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"px", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{"py", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{"pz", " ", "\[Rule]", " ", "1"}], ",", " ", 
      RowBox[{"pw", " ", "\[Rule]", " ", "0"}], ",", " ", 
      RowBox[{
       RowBox[{
        SuperscriptBox["qw", "2"], "+", 
        SuperscriptBox["qx", "2"], "+", 
        SuperscriptBox["qy", "2"], "+", 
        SuperscriptBox["qz", "2"]}], " ", "\[Rule]", " ", "1"}]}], "}"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.896247975078918*^9, 3.896247980087487*^9}, {
   3.8962482906307383`*^9, 3.8962482951507607`*^9}, 3.896248660294196*^9, 
   3.8962488243275213`*^9},
 CellLabel->"In[41]:=",ExpressionUUID->"8be384f4-7086-42d5-8219-cdd846ffaf18"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Aw", " ", "=", " ", 
   RowBox[{
    RowBox[{"pTrans", " ", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"px", " ", "\[Rule]", " ", "0"}], ",", " ", 
       RowBox[{"py", " ", "\[Rule]", " ", "0"}], ",", " ", 
       RowBox[{"pz", " ", "\[Rule]", " ", "0"}], ",", " ", 
       RowBox[{"pw", " ", "\[Rule]", " ", "1"}], ",", " ", 
       RowBox[{
        RowBox[{
         SuperscriptBox["qw", "2"], "+", 
         SuperscriptBox["qx", "2"], "+", 
         SuperscriptBox["qy", "2"], "+", 
         SuperscriptBox["qz", "2"]}], " ", "\[Rule]", " ", "1"}]}], "}"}]}], 
    " ", "/.", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       SuperscriptBox["qw", "2"], "+", 
       SuperscriptBox["qx", "2"], "+", 
       SuperscriptBox["qy", "2"], "+", 
       SuperscriptBox["qz", "2"]}], " ", "\[Rule]", " ", "1"}], "}"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.896247988834854*^9, 3.89624799399821*^9}, {
   3.8962480370855503`*^9, 3.8962480643899612`*^9}, {3.896248297270608*^9, 
   3.896248302846192*^9}, 3.8962486625745277`*^9, {3.8962488252702045`*^9, 
   3.8962488936779795`*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"cefaeeee-39e8-4baa-91df-cd7730660ca3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"S", " ", "=", 
  RowBox[{
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Ax", ",", " ", "Ay", ",", " ", "Az", ",", " ", "Aw"}], "}"}], 
     ",", " ", 
     RowBox[{"{", "1", "}"}]}], "]"}], "//", "MatrixForm"}]}]], "Input",
 CellChangeTimes->{{3.896248500914611*^9, 3.896248633820856*^9}, {
  3.896248704023555*^9, 3.896248804574097*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"ad8fbb8c-bea6-4c73-a6b2-6697d5e2d2ba"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       SuperscriptBox["qw", "2"], "+", 
       SuperscriptBox["qx", "2"], "-", 
       SuperscriptBox["qy", "2"], "-", 
       SuperscriptBox["qz", "2"]}], 
      RowBox[{
       RowBox[{"2", " ", "qx", " ", "qy"}], "+", 
       RowBox[{"2", " ", "qw", " ", "qz"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", "qw", " ", "qy"}], "+", 
       RowBox[{"2", " ", "qx", " ", "qz"}]}], "0"},
     {
      RowBox[{
       RowBox[{"2", " ", "qx", " ", "qy"}], "-", 
       RowBox[{"2", " ", "qw", " ", "qz"}]}], 
      RowBox[{
       SuperscriptBox["qw", "2"], "-", 
       SuperscriptBox["qx", "2"], "+", 
       SuperscriptBox["qy", "2"], "-", 
       SuperscriptBox["qz", "2"]}], 
      RowBox[{
       RowBox[{"2", " ", "qw", " ", "qx"}], "+", 
       RowBox[{"2", " ", "qy", " ", "qz"}]}], "0"},
     {
      RowBox[{
       RowBox[{"2", " ", "qw", " ", "qy"}], "+", 
       RowBox[{"2", " ", "qx", " ", "qz"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", "qw", " ", "qx"}], "+", 
       RowBox[{"2", " ", "qy", " ", "qz"}]}], 
      RowBox[{
       SuperscriptBox["qw", "2"], "-", 
       SuperscriptBox["qx", "2"], "-", 
       SuperscriptBox["qy", "2"], "+", 
       SuperscriptBox["qz", "2"]}], "0"},
     {"0", "0", "0", "1"}
    },
    GridBoxAlignment->{"Columns" -> {{Center}}, "Rows" -> {{Baseline}}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.896248541193981*^9, 3.896248634197774*^9}, {
   3.8962486924418926`*^9, 3.896248719396349*^9}, {3.8962487664629574`*^9, 
   3.896248794375782*^9}, 3.896248837362438*^9, 3.896248896123285*^9},
 CellLabel->
  "Out[50]//MatrixForm=",ExpressionUUID->"7c317d41-9bfe-4834-bd0c-\
47ba3af2534e"]
}, Open  ]]
},
WindowSize->{1130, 848},
WindowMargins->{{Automatic, 253}, {Automatic, 39}},
Magnification:>2. Inherited,
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (2019\:5e744\:67088\
\:65e5)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 169, 3, 62, "Item",ExpressionUUID->"209668fd-18c1-45fc-b43f-381cc2e6cd6d"],
Cell[730, 25, 637, 15, 97, "Input",ExpressionUUID->"9eb72d7a-445e-495f-9e08-fa10cea388e9"],
Cell[1370, 42, 379, 8, 87, "Input",ExpressionUUID->"4ffd4c0f-1428-4124-95d8-3454b2df4212"],
Cell[1752, 52, 286, 6, 57, "Input",ExpressionUUID->"96cb7322-7544-4bb3-ad58-73e0c8b7c7ab"],
Cell[CellGroupData[{
Cell[2063, 62, 343, 6, 87, "Input",ExpressionUUID->"3187cc61-e354-41c6-a8bd-ef2077b6f6ff"],
Cell[2409, 70, 459, 14, 65, "Output",ExpressionUUID->"40ed33fa-06f9-491d-879d-a8094f746a0e"]
}, Open  ]],
Cell[2883, 87, 629, 14, 87, "Input",ExpressionUUID->"f5ab1201-ae2a-45f5-badc-23f86f96ef1a"],
Cell[3515, 103, 810, 20, 159, "Input",ExpressionUUID->"3179ea4c-9bb3-4dfb-adf9-5c6df0afe4b0"],
Cell[4328, 125, 710, 18, 159, "Input",ExpressionUUID->"c1cf67bf-211a-47ac-a3eb-b53f46859a92"],
Cell[5041, 145, 778, 19, 159, "Input",ExpressionUUID->"005be437-3579-4650-8ddd-a25fb451cf21"],
Cell[CellGroupData[{
Cell[5844, 168, 1269, 22, 87, "Input",ExpressionUUID->"6e395f7f-a1aa-4e8f-b3bc-13ddd4c0a46f"],
Cell[7116, 192, 2287, 66, 184, "Output",ExpressionUUID->"42910cfe-194e-4385-a741-d45590df5a5d"]
}, Open  ]],
Cell[9418, 261, 667, 11, 142, "Item",ExpressionUUID->"2190c82c-85e2-4d56-b643-98981319ee91"],
Cell[10088, 274, 310, 7, 174, "Code",ExpressionUUID->"b635e2f6-ebc6-4e8d-b6b0-f8e81c9dc52b",
 InitializationCell->False],
Cell[10401, 283, 149, 3, 97, "Input",ExpressionUUID->"3c756986-6164-4927-a5fa-9470b3b10776"],
Cell[10553, 288, 526, 8, 62, "Item",ExpressionUUID->"fcea923a-c8c1-4d66-b5d4-607843cdb9ff"],
Cell[11082, 298, 841, 20, 136, "Input",ExpressionUUID->"a940db92-8077-4575-947c-ef760282914e"],
Cell[11926, 320, 1631, 43, 159, "Input",ExpressionUUID->"825ffb8d-f1ba-4ef2-b29f-845f5ae84f68"],
Cell[CellGroupData[{
Cell[13582, 367, 1689, 53, 237, "Input",ExpressionUUID->"f1442002-246a-4fa0-9ec6-d30b0158a241"],
Cell[15274, 422, 468, 12, 65, "Output",ExpressionUUID->"bc21a34f-dfe5-4af2-b08a-c5657d51c456"],
Cell[15745, 436, 560, 14, 70, "Output",ExpressionUUID->"c99d86d1-5c25-4d84-b358-6b922b58e27e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[16342, 455, 1727, 49, 237, "Input",ExpressionUUID->"a795cf5f-5c09-48f1-9598-f0acee7276f5"],
Cell[18072, 506, 9493, 276, 872, "Output",ExpressionUUID->"f92abf02-ab44-43a7-8990-fdfb196c5da2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[27602, 787, 531, 10, 159, "Input",ExpressionUUID->"3cb99798-a53c-45d9-b37a-20c564ee61e1"],
Cell[28136, 799, 9029, 274, 872, "Output",ExpressionUUID->"1b9dd5ab-f7fb-4956-b6cb-1f59f61c38af"]
}, Open  ]],
Cell[37180, 1076, 1011, 22, 106, "Input",ExpressionUUID->"d06aee18-c3e2-4048-ba83-f90311bb0ef9"],
Cell[38194, 1100, 855, 20, 106, "Input",ExpressionUUID->"57593f1d-d076-4867-9cc6-b8872f3052c2"],
Cell[39052, 1122, 857, 20, 106, "Input",ExpressionUUID->"8be384f4-7086-42d5-8219-cdd846ffaf18"],
Cell[39912, 1144, 1221, 30, 146, "Input",ExpressionUUID->"cefaeeee-39e8-4baa-91df-cd7730660ca3"],
Cell[CellGroupData[{
Cell[41158, 1178, 470, 11, 87, "Input",ExpressionUUID->"ad8fbb8c-bea6-4c73-a6b2-6697d5e2d2ba"],
Cell[41631, 1191, 2057, 58, 251, "Output",ExpressionUUID->"7c317d41-9bfe-4834-bd0c-47ba3af2534e"]
}, Open  ]]
}
]
*)

